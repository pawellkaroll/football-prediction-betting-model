# Football prediction betting model
This project was created at the turn of 2022/2023, it was basically my master's thesis, which I managed to defend. I spent several months researching the problem of predicting the results of football matches using machine learning models and using these models to create a profitable betting strategy. I have chosen the English Premier League in the 2021/2022 season as my object of interest. In this repository I will only present the empirical part and the final results. I will go through the most important issues in the following order: 1. data preprocessing and exploratory data analysis 2. summary of machine learning models 3. implementing various betting strategies
## Data Preprocessing & EDA
The first important and most time-consuming issue was collecting data. Data was collected from several sources including https://www.football-data.co.uk, https://fbref.com, https://www.transfermarkt.com and http://clubelo.com (part of this work was made via webscraping). Then, data structuring was performed, such as merging tables, removing irrelevant variables, and unifying names. The goal of this stage was to achieve one database (consisting of 380 rows, each row was responsible for 1 match with number of features) which would be the cornerstone of further work.  <br />
Fetaure engineering took a lot of time. I won't go into details here, but ultimately there were 335 (!) variables, which were divided into the following categories: 1. betting odds 2. market values 3. performance rankings 4. match stats 5. form 6. home field advantage 7. rest 8. formation and tactics 9. other. Of course, the number of these variables was later limited using statistical tests.<br />
Next, EDA has been carried out. Test statistics were calculated, such topics were examined variability of the number of goals over time, correlation between the number of goals and the number of expected goals and the distribution of the target variable. Finally, the data preprocessing has been done (dealing with outliers, missing values, etc.)
## Machine Learning Models
In the presented work, 3 machine learning models were used, i.e. logistic regression, random forests and xgboost. It was decided that the first 10 gameweeks of the season would not be taken into account when building models (a lot of missing data due to, for example, moving averages). Therefore, the data set was divided into a training set consisting of 20 gameweeks (from 11 to 30) and a test set containing the last 8 rounds of the season (31-38). The method of optimizing the models was similar for each of them. Hyperparameter tuning using 3 times repeated stratified 5-fold cross-validation. Out of the 8 classification measures, only AUC showed a result other than the victory of logistic regression in the case of the training set. The accuracy of logistic regression for cross-validation is 0.6. As for the test set, the models achieved similar results with xgboost slightly coming to the fore (0.562 accuracy). More information about the performance of models in notebooks.
## Betting strategies
The last stage was the implementation of the machine learning models being built for something like a real-life example, i.e. football "betting". Various betting strategies were also used, including: 1. fixed fee per bet 2. fixed expected return 3. fixed percentage of current bankroll 4. high probability bets 5. low probability bets 6. variance optimization 7. Kelly criterion. Two approaches were used, namely betting with average odds (in case the hypothetical player is lazy and does not want to bet with several bookmakers at the same time) or betting with maximum odds (our hypothetical player make the effort to bet with several bookmakers). Different variants and corresponding results can be checked thoroughly in the "strategies" notebook, but the best turned out to be the Kelly criterion strategy combined with ensemble of models. This combination achieved 29 percent return on investment. I will just say at the end that the aim of this work was never to find a breakthrough model that would crash the betting market, so the fact that the vast majority of strategies allowed me not to lose on the betting market, which is a very pleasing result.